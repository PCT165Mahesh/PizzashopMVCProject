@* @model PizzashopMVCProject.ViewModels.PaginationViewModel *@
@{
    ViewData["Title"] = "User List Page";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="body_content">
    <!-- User List Starts-->
    <div class="d-flex flex-column flex-lg-row justify-content-between user_list_header">
        <!-- User Header -->
        <div class="user_header fs-2 fs-lg-1">
            <span>Users</span>
        </div>
        <!-- Search box and button starts-->
        <div class="d-flex flex-row">
            <form class="d-flex position-relative" role="search">
                <input class="form-control me-2" type="search" using Microsoft.EntityFrameworkCore.Metadata.Internal;
                    placeholder="Search" id="search" aria-label="Search" />
                <label for="search" class="search_icon"><img src="~/images/icons/search.svg" alt="" /></label>
            </form>
            <button type="button" class="btn add_user_btn">
                <a href="./add_user.html" class="text-white text-decoration-none">+Add User</a>
            </button>
        </div>
        <!-- Search box and button Ends -->
    </div>

    <!-- User List table Starts -->

    <div class="table_container table-responsive">
        <table class="table">
            <thead>
                <tr>
                    <th scope="col">
                        Name
                        <button class="btn p-0">
                            <img src="~/images/icons/arrow-up.svg" alt="" width="20px" />
                        </button>
                        <button class="btn p-0">
                            <img src="~/images/icons/arrow-down.svg" alt="" width="20px" />
                        </button>
                    </th>
                    <th scope="col">Email</th>
                    <th scope="col">Phone</th>
                    <th scope="col">
                        Role
                        <button class="btn p-0">
                            <img src="~/images/icons/arrow-up.svg" alt="" width="20px" />
                        </button>
                        <button class="btn p-0">
                            <img src="~/images/icons/arrow-down.svg" alt="" width="20px" />
                        </button>
                    </th>
                    <th scope="col">Status</th>
                    <th scope="col">Action</th>
                </tr>
            </thead>
            <tbody id="userListBody">

                @* @foreach (var user in Model.UserList)
                {
                    <tr>
                        <td class="user_profile">
                            <img src="~/images/Default_pfp.svg.png" alt="" />
                            <span>@user.UserName</span>
                        </td>
                        <td>@user.Email</td>
                        <td>@user.Phone</td>
                        <td>@user.RoleName</td>
                        <td>
                            @if (user.Status)
                            {
                                <div class="status active_status">Active</div>
                            }
                            else
                            {
                                <div class="status inactive_status">Inactive</div>
                            }
                        </td>
                        <td>
                            <a class="btn user_action" href="./edit_user.html">
                                <img src="~/images/icons/edit-pen.svg" alt="" />
                            </a>
                            <button class="btn user_action" type="button" data-bs-toggle="modal" data-bs-target="#myModal">
                                <img src="~/images/icons/delete-trash-icon.svg" alt="" />
                            </button>
                        </td>
                    </tr>
                } *@
            </tbody>
        </table>
        <!-- Paggination Frontend Start -->
        <div class="d-flex flex-row align-items-center justify-content-end pagination_container">
            <span>Items per page:</span>

            <!-- Page  Numbers Drop Down -->
            <select class="form-select w-auto" aria-label="Default select example" id="selectPageSize">
                <option selected>3</option>
                <option value="5">5</option>
                <option value="10">10</option>
                <option value="15">15</option>
            </select>

            <span style="margin-left: 8px">
                @* Showing @((Model.PageNo - 1) * Model.PageSize + 1) - @(Math.Min(Model.PageNo * Model.PageSize,
                Model.TotalRecords)) of @Model.TotalRecords *@
            </span>

            <button type="button" class="btn border border-black prev_page" id="prevPageIcon">
                <img src="~/images/icons/chevron-left.svg" alt="" />
            </button>
            <button type="button" class="btn border border-black" id="nextPageIcon">
                <img src="~/images/icons/chevron-right.svg" alt="" />
            </button>
        </div>
        <!-- Pagination Frontend Ends -->
    </div>

    <!-- Delete user Modal -->
    <div class="modal fade" tabindex="-1" id="myModal" aria-labelleby="modal-title">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header border-0">
                    <h5 class="modal-title fw-bolder" style="color: #6c757d">
                        Delete Confirmation
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body d-flex flex-column align-items-center">
                    <img src="~/images/icons/warning-icon.svg" alt="" width="35px" />
                    <p class="fs-5 fw-bold" style="color: #6c757d">
                        Are you sure you want to delete this user?
                    </p>
                </div>
                <div class="modal-footer border-0 d-flex flex-row justify-content-center">
                    <button type="button" class="btn btn-primary">Yes</button>
                    <button type="button" class="btn cancle_btn" data-bs-dismiss="modal">
                        No
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>


@section Scripts {
    <script>
        var pageNo = 1;

        $(document).ready(function () {
            pageNo = 1;
            $.ajax({
                url: '@Url.Action("GetUserList", "User")',
                type: "GET",
                data: { pageNo: pageNo, pageSize: $("#selectPageSize").val() },
                success: function (users) {
                    @* console.log("Page pageSize select"); *@
                    console.log(users);
                    $.each(users, function (index, user) {
                        $("#userListBody").append(`
                            <tr>
                                <td>
                                    <img src="/images/Default_pfp.svg.png" alt="" width="25px">
                                    ${user.userName}
                                </td>
                                <td>${user.email}</td>
                                <td>${user.phone}</td>
                                <td>${user.roleName}</td>
                                <td>
                                ${user.status ? '<div class="status active_status">Active</div>' : '<div class="status inactive_status">Inactive</div>'}

                                </td>
                                <td>
                                    <a class="btn user_action" href="./edit_user.html">
                                        <img src="/images/icons/edit-pen.svg" alt="" />
                                    </a>
                                    <button
                                        class="btn user_action"
                                        type="button"
                                        data-bs-toggle="modal"
                                        data-bs-target="#myModal"
                                    >
                                        <img src="/images/icons/delete-trash-icon.svg" alt="" />
                                    </button>
                                </td>
                            </tr>
                        `);
                    });
                },
                error: function () {
                    console.error(users);
                    alert("Error loading users");
                }
            });
        })

        $("#selectPageSize").change(function () {
            console.log("H");

            var pageSize = $(this).val();
            $.ajax({
                url: '@Url.Action("GetUserList", "User")',
                type: "GET",
                data: { pageNo: 1, pageSize: pageSize },
                success: function (users) {
                    $("#userListBody").empty();
                    console.log(users);
                    $.each(users, function (index, user) {

                        $("#userListBody").append(`
                            <tr>
                                <td>
                                    <img src="/images/Default_pfp.svg.png" alt="" width="25px">
                                    ${user.userName}
                                </td>
                                <td>${user.email}</td>
                                <td>${user.phone}</td>
                                <td>${user.roleName}</td>
                                <td>
                                ${user.status ? '<div class="status active_status">Active</div>' : '<div class="status inactive_status">Inactive</div>'}

                                </td>
                                <td>
                                    <a class="btn user_action" href="./edit_user.html">
                                        <img src="/images/icons/edit-pen.svg" alt="" />
                                    </a>
                                    <button
                                        class="btn user_action"
                                        type="button"
                                        data-bs-toggle="modal"
                                        data-bs-target="#myModal"
                                    >
                                        <img src="/images/icons/delete-trash-icon.svg" alt="" />
                                    </button>
                                </td>
                            </tr>
                        `);
                    });
                },
                error: function () {
                    console.error(users);
                    alert("Error loading users");
                }
            });
        })

        $("#nextPageIcon").click(function () {
            console.log("H");

            var pageSize = $("#selectPageSize").val();
            pageNo++;
            $.ajax({
                url: '@Url.Action("GetUserList", "User")',
                type: "GET",
                data: { pageNo: pageNo, pageSize: pageSize },
                success: function (users) {
                    $("#userListBody").empty();
                    $.each(users, function (index, user) {
                        $("#userListBody").append(`
                            <tr>
                                <td>
                                    <img src="/images/Default_pfp.svg.png" alt="" width="25px">
                                    ${user.userName}
                                </td>
                                <td>${user.email}</td>
                                <td>${user.phone}</td>
                                <td>${user.roleName}</td>
                                <td>
                                ${user.status ? '<div class="status active_status">Active</div>' : '<div class="status inactive_status">Inactive</div>'}

                                </td>
                                <td>
                                    <a class="btn user_action" href="./edit_user.html">
                                        <img src="/images/icons/edit-pen.svg" alt="" />
                                    </a>
                                    <button
                                        class="btn user_action"
                                        type="button"
                                        data-bs-toggle="modal"
                                        data-bs-target="#myModal"
                                    >
                                        <img src="/images/icons/delete-trash-icon.svg" alt="" />
                                    </button>
                                </td>
                            </tr>
                        `);
                    });
                },
                error: function () {
                    console.error(users);
                    alert("Error loading users");
                }
            });
        })

        $("#prevPageIcon").click(function () {
            console.log("H");
            var pageSize = $("#selectPageSize").val();
            pageNo--;
            $.ajax({
                url: '@Url.Action("GetUserList", "User")',
                type: "GET",
                data: { pageNo: pageNo, pageSize: pageSize },
                success: function (users) {
                    $("#userListBody").empty();
                    $.each(users, function (index, user) {
                        $("#userListBody").append(`
                            <tr>
                                <td>
                                    <img src="/images/Default_pfp.svg.png" alt="" width="25px">
                                    @* ${user.userName} *@
                                </td>
                                <td>${user.email}</td>
                                <td>${user.phone}</td>
                                <td>${user.roleName}</td>
                                <td>
                                ${user.status ? '<div class="status active_status">Active</div>' : '<div class="status inactive_status">Inactive</div>'}

                                </td>
                                <td>
                                    <a class="btn user_action" href="./edit_user.html">
                                        <img src="/images/icons/edit-pen.svg" alt="" />
                                    </a>
                                    <button
                                        class="btn user_action"
                                        type="button"
                                        data-bs-toggle="modal"
                                        data-bs-target="#myModal"
                                    >
                                        <img src="/images/icons/delete-trash-icon.svg" alt="" />
                                    </button>
                                </td>
                            </tr>
                         `);
                    });
                },
                error: function () {
                    console.error(users);
                    alert("Error loading users");
                }
            });
        })
    </script>
}